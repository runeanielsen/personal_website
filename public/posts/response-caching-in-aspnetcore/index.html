<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>Response Caching in ASP.NET Core</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Using caching is an essential way to improve performance in your application. With ASP.NET Core you have to download and setup the associated middlewares. In this blog post, I will introduce you to response caching and show how to implement it in a web application.">
	<meta property="article:published_time" content="17-07-2017 00:00:00">

	<link async href="https://fonts.googleapis.com/css2?family=Jura:wght@300;400;500;600;700" rel="stylesheet"> 
	<link async rel="stylesheet" href="/css/main.css" type="text/css" />
	<link async rel="icon" href="/favicon.ico">

	<script async src="https://kit.fontawesome.com/0d71694d01.js" crossorigin="anonymous"></script>
</head>
<body>
	<div class="grid-container">
		<header class="header">
    <div class="header-collection">
        <div class="header-item">
            <a class="header-item__link" href="/">
                <h1 class="header-item__title">Rune Nielsen | Freelance Software Developer</h1>
            </a>
        </div>     
    </div>
    <div class="header-collection">
        <div class="header-item">
            <a class="header-item__link" target="_blank" href="https://github.com/runeanielsen">
                <p class="header-item__icon">
                    <i class="fab fa-github-square"></i>
                </p>
            </a>
        </div>
        <div class="header-item">
            <a class="header-item__link" target="_blank" href="https://twitter.com/runeanielsen">
                <p class="header-item__icon">
                    <i class="fab fa-twitter-square"></i> 
                </p>
            </a>
        </div>
        <div class="header-item">
            <a class="header-item__link" target="_blank" href="https://linkedin.com/in/runeanielsen">
                <p class="header-item__icon">
                    <i class="fab fa-linkedin"></i>
                </p> 
            </a>
        </div>    
    </div>
</header>

		
<div class="blog-post">
    <div class="blog-post__content">
        <h1 id="response-caching-in-aspnet-core">Response Caching in ASP.NET Core</h1>
<p>Using caching is an essential way to improve performance in your application. With ASP.NET Core you have to download and setup the associated middlewares. In this blog post, I will introduce you to response caching and show how to implement it in a web application.</p>
<h2 id="what-is-response-caching">What is response caching</h2>
<p>Response caching is a way to add cache headers to an HTTP response. The cache headers tell the browser how long it should cache each response and thereby reduce the load on the server and provide faster response time to the users.</p>
<p>Response caching works because all browsers implement an HTTP cache. The HTTP cache is the place where the browser cache HTTP responses that contain the &ldquo;Cache-Control&rdquo; attribute. The attribute contains a value called &ldquo;max-age&rdquo; which specifies how long the browser should cache the data for. The value could look like this &ldquo;max-age=120&rdquo; where the value is in seconds. You can use response caching to cache most things that are returned by the HTTP protocol, this includes images, scripts, and HTML pages.</p>
<p>_An example of a response header with cache control. _</p>
<p><img src="/blogpost/f4f89487-9ba6-46ea-bab3-6f656f66b240.png" alt="example of a response header with cache control"></p>
<p>Most of the time you will also see response headers with the e-tag attribute. The e-tag attribute is a token based value that identifies if the content on the server has changed or not. If the e-tag value is still the same after the expiration of cache-control, the browser will return the same cached version of the content to the user. In most cases, you would want to use the e-tag attribute.</p>
<p>_An example of a response header using the e-tag attribute. _</p>
<p><img src="/blogpost/dfsfdsfdsfsfsfewdsfwsdsde3343242312.png" alt="Cached script with e-tag attribute"></p>
<h2 id="implement-response-caching-in-aspnet-core">Implement response caching in ASP.NET Core</h2>
<p>The implementation uses en empty ASP.NET Core version 1.1. The response caching implementation is inside the ASP.NET MVC library so go to your project.json file and add the following dependency.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#e6db74">&#34;Microsoft.AspNetCore.Mvc&#34;</span>: <span style="color:#e6db74">&#34;1.1.0&#34;</span>
</code></pre></div><p>When the package has been installed go to the &ldquo;Startup.cs&rdquo; file and go to the &ldquo;Configure&rdquo; method add the use of static files and use of MVC to the bottom of the method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">app.UseStaticFiles();

app.UseMvc(routes =&gt; {
    routes.MapRoute(
    name: <span style="color:#e6db74">&#34;default&#34;</span>, template: <span style="color:#e6db74">&#34;{controller=Home}/{action=Index}/{id?}&#34;</span>);
});
</code></pre></div><p>When that is done when can add the response cache configurations. Inside the same file go to the &ldquo;ConfigureServices&rdquo; method and add the following code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">services.AddMvc(options = &gt;{
    options.CacheProfiles.Add(<span style="color:#e6db74">&#34;Default&#34;</span>, <span style="color:#66d9ef">new</span> CacheProfile() {
        Duration = <span style="color:#ae81ff">120</span>
    });
    options.CacheProfiles.Add(<span style="color:#e6db74">&#34;Never&#34;</span>, <span style="color:#66d9ef">new</span> CacheProfile() {
        Location = ResponseCacheLocation.None,
        NoStore = <span style="color:#66d9ef">true</span>
    });
});
</code></pre></div><p>The configuration adds two cache profiles, one named &ldquo;Default&rdquo; and one named &ldquo;Never&rdquo;. The profile names will be used when we specify the response caching on the controllers. The duration attribute specifies how long we want our max-age value you to be, and as stated before, the value is defined in seconds. This profile will be used for response caching.</p>
<p>The other profile is used when we don&rsquo;t want to cache. The &ldquo;Location&rdquo; property specifies that we don&rsquo;t want the browser to store the data, and the &ldquo;NoStore&rdquo; attribute tells that we don&rsquo;t want the values to be stored.</p>
<p>Next step is to create a controller to we can test our profiles. So I have created a basic controller with two action methods all using the &ldquo;ResponseCache&rdquo; attribute. The response cache attribute comes from the &ldquo;Microsoft.AspNetCore.Mvc&rdquo; namespace.</p>
<p>Inside the attribute, we can either specify the values ourselves or make use of our profiles. In this case, I added a response cache attribute to the whole Controller, if no attribute is defined on a method inside the controller it will set a max-age value of 60 to the HTTP response that the method sends back to the user. The two methods make use of the &ldquo;Default&rdquo; profile and the &ldquo;Never&rdquo; profile, where both will override the attribute of the controller.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.Mvc;

<span style="color:#66d9ef">namespace</span> ResponseCacheSample.Controllers
{
<span style="color:#a6e22e">    [ResponseCache(Duration = 60)]</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeController</span> : Controller
    {
<span style="color:#a6e22e">        [ResponseCache(CacheProfileName = &#34;Default&#34;)]</span>
        <span style="color:#66d9ef">public</span> IActionResult Index()
        {
            <span style="color:#66d9ef">return</span> View();
        }
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">        [ResponseCache(CacheProfileName = &#34;Never&#34;)]</span>
        <span style="color:#66d9ef">public</span> IActionResult Contact()
        {
            <span style="color:#66d9ef">return</span> View();
        }
    }
}
</code></pre></div><p>In the image below I have tested both methods and this is the headers that will be received using the two profiles.</p>
<p>Profile &ldquo;Default&rdquo;</p>
<p><img src="/blogpost/dabf696d-6d34-4710-90f9-f729eaef8d0b.png" alt=""></p>
<p>Profile &ldquo;Never&rdquo;</p>
<p><img src="/blogpost/fc86c3f7-37ed-4649-8901-4150eac2188c.png" alt=""></p>
   
    </div>
</div>

		<footer class="footer">
</footer>
	
	</div>
</body>
</html>
