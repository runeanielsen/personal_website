<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>View Models in ASP.NET MVC</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="In ASP.NET MVC best practice is to use view models. A view model in ASP.NET MVC is a simple class only containing the data, that you want to display on your view. A view model can contain all from static text to input values like a assortment of countries for a drop-down menu.">
	<meta property="article:published_time" content="17-07-2017 00:00:00">

	<link async href="https://fonts.googleapis.com/css2?family=Jura:wght@300;400;500;600;700" rel="stylesheet"> 
	<link async rel="stylesheet" href="/css/main.css" type="text/css" />
	<link async rel="icon" href="/favicon.ico">

	<script async src="https://kit.fontawesome.com/0d71694d01.js" crossorigin="anonymous"></script>
</head>
<body>
	<div class="grid-container">
		<header class="header">
    <div class="header-collection">
        <div class="header-item">
            <a class="header-item__link" href="/">
                <h1 class="header-item__title">Rune Nielsen | Freelance Software Developer</h1>
            </a>
        </div>     
    </div>
    <div class="header-collection">
        <div class="header-item">
            <a class="header-item__link" target="_blank" href="https://github.com/runeanielsen">
                <p class="header-item__icon">
                    <i class="fab fa-github-square"></i>
                </p>
            </a>
        </div>
        <div class="header-item">
            <a class="header-item__link" target="_blank" href="https://twitter.com/runeanielsen">
                <p class="header-item__icon">
                    <i class="fab fa-twitter-square"></i> 
                </p>
            </a>
        </div>
        <div class="header-item">
            <a class="header-item__link" target="_blank" href="https://linkedin.com/in/runeanielsen">
                <p class="header-item__icon">
                    <i class="fab fa-linkedin"></i>
                </p> 
            </a>
        </div>    
    </div>
</header>

		
<div class="blog-post">
    <div class="blog-post__content">
        <h1 id="view-models-in-aspnet-mvc">View Models in ASP.NET MVC</h1>
<p>In ASP.NET MVC best practice is to use view models. A view model in ASP.NET MVC is a simple class only containing the data, that you want to display on your view. A view model can contain all from static text to input values like an assortment of countries for a drop-down menu.</p>
<p>Let’s say that we have an Employee class and it contains the following properties.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">using</span> System;

<span style="color:#66d9ef">namespace</span> ViewModelExample.Models
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Employee</span>
    {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Id { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> FirstName { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> LastName { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
        <span style="color:#66d9ef">public</span> DateTime DateCreated { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
    }
}
</code></pre></div><p>We want to be able to create a new Employee and add it to a database. One way to do this would be to set the Employee class as the model in the view. The bad thing about that strategy is that it will send out the DateCreated and the Id properties to the view.</p>
<p>Instead of doing that we will create a view model only containing the data we want to display on the view.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">namespace</span> ViewModelExample.Models
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CreateEmployeeViewModel</span>
    {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> FirstName { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> LastName { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
    }
}
</code></pre></div><p>Notice that ‘ViewModel’ is part of the class name, the reason for this is a naming convention to easy spot view models from domain models. Another thing is that it contains the verb ‘Create’ to specify that it is for the Create Action in the Employee Controller. You don&rsquo;t have to follow the action name prefix, but the &lsquo;ViewModel&rsquo; part of the view model will help you in the future when searching and handling files.</p>
<p>As you can see in the view model we created, it only contains two properties from the domain model. The ‘Id’ is not there because it will be autogenerated and accordingly no reason to make it available in the view. The same thing with the ‘DateCreated’ property which will be made on the creation of the employee.</p>
<h2 id="using-a-view-model-in-a-controller">Using a view model in a controller</h2>
<p>Now that we have created a view model we want to make use of it. So in the Employee controllers &ldquo;Create&rdquo; action, we create a new view model and pass it to the view.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">using</span> System.Web.Mvc;
<span style="color:#66d9ef">using</span> ViewModelExample.Models;
<span style="color:#66d9ef">using</span> ViewModelExample.Viewmodels;

<span style="color:#66d9ef">namespace</span> ViewModelExample.Controllers
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmployeeController</span> : Controller
    {
        <span style="color:#66d9ef">public</span> ActionResult Create()
        {
            <span style="color:#66d9ef">var</span> vm = <span style="color:#66d9ef">new</span> CreateEmployeeViewModel();

            <span style="color:#66d9ef">return</span> View(vm);
        }
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">        [HttpPost]</span>
        <span style="color:#66d9ef">public</span> ActionResult Create(CreateEmployeeViewModel vm)
        {
            <span style="color:#66d9ef">var</span> employee = <span style="color:#66d9ef">new</span> Employee
            {
                FirstName = vm.FirstName,
                LastName = vm.LastName
            };

            <span style="color:#75715e">// Save the Employee to an database
</span><span style="color:#75715e"></span>
            <span style="color:#66d9ef">return</span> View(<span style="color:#e6db74">&#34;Index&#34;</span>, <span style="color:#e6db74">&#34;Home&#34;</span>);
        }
    }
}
</code></pre></div><p>In the above code, there are two very simple implementations of using a view model, one for the GET request and one for the POST request.</p>
<p>If we take a look at the POST method implementation we can see that there is a mapping happening from the view model to the domain model. The reason for this is that we don&rsquo;t want to send the view model down to the domain layer, the view model is only created to act as a data structure for the view and not a data structure to be operated on, in the domain layer.</p>
<p>You can do the mapping manually like it is being implemented in the example above or you can use a mapping framework like Automapper, I have created a guide on it <a href="/posts/automapper-the-basics">here</a>.</p>
<h2 id="view-models-in-razor-views">View models in Razor views</h2>
<p>To use a view model in the standard view rendering framework for ASP.NET, Razor, you define the model as you normally would at the top of the file with the <strong>@model</strong> syntax.</p>
<p>A thing to notice if you’re not very familiar with ASP.NET MVC Razor views is that you can use the @Html helper methods to make your view strongly typed, so you will get IntelliSense and if your view model changes you will get build errors and therefore have an easier time dealing with application changes.</p>
<p>The following code shows a simple implementation of using a view model in an HTML form with two labels and two text boxes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">@model ViewModelExample.Viewmodels.CreateEmployeeViewModel

<span style="color:#960050;background-color:#1e0010">@</span>{
    ViewBag.Title = <span style="color:#e6db74">&#34;title&#34;</span>;
}

@using (Html.BeginForm(<span style="color:#e6db74">&#34;Create&#34;</span>, <span style="color:#e6db74">&#34;Employee&#34;</span>, FormMethod.Post))
{
    &lt;div class=<span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
        @Html.LabelFor(e =&gt; e.FirstName)
        @Html.TextBoxFor(e =&gt; e.FirstName)
    &lt;/div&gt;

    &lt;div class=<span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
        @Html.LabelFor(e =&gt; e.LastName)
        @Html.TextBoxFor(e =&gt; e.LastName)
    &lt;/div&gt;

    &lt;button type=<span style="color:#e6db74">&#34;submit&#34;</span>&gt;Create&lt;/button&gt;
}
</code></pre></div><h2 id="data-annotations-on-view-models">Data annotations on view models</h2>
<p>If you&rsquo;re not familiar with data annotations, here comes a very quick introduction. A data annotation is a way to declare an attribute to a property, this can be the max string length that the property can hold or what text it should display using a strongly typed view (normally it displays the property name). Data annotations can be very useful on view models because instead of writing all the data validation yourself you can use data annotations and get very quick validation on the data being passed from the views to the controllers.</p>
<p>Using the data annotations that you can see in the code below, we now have validation on the server. If the user tries to create an employee with invalid data according to the data annotations applied to the properties, an error will be thrown displaying what went wrong to the user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">using</span> System.ComponentModel.DataAnnotations;

<span style="color:#66d9ef">namespace</span> ViewModelExample.Viewmodels
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CreateEmployeeViewModel</span>
    {
<span style="color:#a6e22e">        [Display(Name = &#34;First name&#34;)]</span>
<span style="color:#a6e22e">        [MinLength(2)]</span>
<span style="color:#a6e22e">        [MaxLength(50)]</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> FirstName { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">        [Display(Name = &#34;Last name&#34;)]</span>
<span style="color:#a6e22e">        [MinLength(4)]</span>
<span style="color:#a6e22e">        [MaxLength(50)]</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> LastName { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
    }
}
</code></pre></div><p>Below is an example of using the <strong>MaxLength</strong> and <strong>MinLength</strong> annotation, showing the error messages that are displayed if the annotation is being triggered.</p>
<p><img src="/blogpost/e7538f85-7a84-4e7f-82e4-e6c990e32d9f.png" alt="Form using a view mdoel"></p>
<p>To show the validation as seen above you insert the following code into the view:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">&lt;div class=<span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
    @Html.LabelFor(e =&gt; e.LastName)
    @Html.TextBoxFor(e =&gt; e.LastName)
    @Html.ValidationMessageFor(m =&gt; m.LastName)
&lt;/div&gt;
</code></pre></div><p>As well as adding ModelState.IsValid to your controller, to redirect the user back to the view if the view model contains bad data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#a6e22e">[HttpPost]</span>
<span style="color:#66d9ef">public</span> ActionResult Create(CreateEmployeeViewModel vm)
{
    <span style="color:#66d9ef">if</span> (!ModelState.IsValid)
        <span style="color:#66d9ef">return</span> View(<span style="color:#e6db74">&#34;Create&#34;</span>, vm);

    <span style="color:#66d9ef">var</span> employee = <span style="color:#66d9ef">new</span> Employee
    {
        FirstName = vm.FirstName,
        LastName = vm.LastName
    };

    <span style="color:#75715e">// Save the Employee to an database
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> RedirectToAction(<span style="color:#e6db74">&#34;Index&#34;</span>, <span style="color:#e6db74">&#34;Home&#34;</span>);
}
</code></pre></div><p>It is essential to use server-side validation. Using data annotations on view models are one way of doing it, but try to always use client-side validation because it will give a smoother experience for the user as well as reduce the number of server requests.</p>
   
    </div>
</div>

		<footer class="footer">
</footer>
	
	</div>
</body>
</html>
